<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fibroblasts Analysis Portal - Obese OA Data Portal</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üî¨ Fibroblasts Analysis Portal</h1>
            <p>Comprehensive analysis tools for fibroblast cell populations and their functional states</p>
            <div class="github-link">
                <a href="https://github.com/hvgogogo/obese_OA_dp" target="_blank">üìÅ View on GitHub</a>
            </div>
        </div>

        <!-- Information Cards -->
        <div class="info-grid">
            <div class="info-card">
                <h4>üß¨ Fibroblast Markers</h4>
                <div class="info-content">
                    <strong>Identification:</strong> COL1A1, PDGFRA<br>
                    <strong>Subtypes:</strong> CLIC5 (lining), THY1 (sub-lining), CD34 (protective), CYBB (inflammatory)
                </div>
            </div>

            <div class="info-card">
                <h4>üî¨ Key Findings</h4>
                <div class="info-content">
                    <strong>CD34+ Loss:</strong> 54.49% reduced in obese OA<br>
                    <strong>Pathways:</strong> Hypoxia (HIF1Œ±), Adipogenesis (PPARG), ECM degradation (MMP3/13)
                </div>
            </div>

            <div class="info-card">
                <h4>üìä Quick Guide</h4>
                <div class="info-content">
                    <strong>Basic:</strong> Select gene ‚Üí Update Visualization<br>
                    <strong>GSEA:</strong> Choose subtype ‚Üí Load DEGs/Pathways<br>
                    <strong>Compare:</strong> Obese vs Non-obese, OA vs Healthy
                </div>
            </div>
        </div>

        <!-- Module Navigation -->
        <div class="module-nav">
            <h3>üìã Analysis Modules</h3>
            <div class="module-tabs">
                <div class="module-tab active" data-module="basic">üìä Basic Analysis</div>
                <div class="module-tab" data-module="gsea">üß¨ GSEA</div>
                <div class="module-tab" data-module="trajectory">üîÑ Cell Trajectory</div>
                <div class="module-tab" data-module="interaction">üîó Cell Interaction</div>
            </div>
        </div>

        <!-- Module 1: Basic Analysis -->
        <div class="module-content active" id="basic-module">
            <!-- Analysis Controls -->
            <div class="controls">
                <h3>üéõÔ∏è Analysis Controls</h3>
                <div class="controls-row">
                    <div class="control-group">
                        <label for="custom-gene">Gene Name:</label>
                        <div class="gene-input-container">
                            <input type="text" id="custom-gene" placeholder="Type gene name (e.g., CD34, VIM, COL1A1...)" />
                            <div id="gene-suggestions"></div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="grouped-by-select">Grouped By:</label>
                        <select id="grouped-by-select">
                            <option value="harmony_annotation">Harmony Annotation</option>
                            <option value="disease_state">Disease State</option>
                        </select>
                    </div>
                    
                    <div class="button-hint-container">
                        <button id="update-btn" onclick="updateVisualization()">Update Visualization</button>
                        <div id="gene-hint" class="gene-hint"></div>
                    </div>
                </div>
                
                <div class="controls-help">
                    <small><strong>Quick genes to try:</strong> CD34, VIM, COL1A1, COL3A1, FN1, ACTA2, PDGFRA, THY1, DCN, LUM, POSTN</small>
                </div>
            </div>

            <!-- Basic Analysis Visualizations -->
            <div class="analysis-grid">
                <div class="analysis-card">
                    <h3>üìä UMAP Visualization</h3>
                    <div id="umap-plot" class="viz-container">
                        <div class="viz-placeholder">
                            <div class="loading-spinner"></div>
                            <p>üîÑ Loading UMAP visualization...</p>
                            <small>Cell clusters and subtypes</small>
                        </div>
                    </div>
                </div>

                <div class="analysis-card">
                    <h3>üìä Gene Expression</h3>
                    <div id="gene-expression-plot" class="viz-container">
                        <div class="viz-placeholder">
                            <div class="loading-spinner"></div>
                            <p>üîÑ Loading gene expression...</p>
                            <small>Expression levels on UMAP</small>
                        </div>
                    </div>
                </div>

                <div class="analysis-card">
                    <h3>üéØ Marker Expression</h3>
                    <div id="marker-plot" class="viz-container">
                        <div class="viz-placeholder">
                            <div class="loading-spinner"></div>
                            <p>üîÑ Loading marker expression...</p>
                            <small>Expression levels across cell populations</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Module 2: GSEA -->
        <div class="module-content" id="gsea-module">
            <!-- DEG Analysis Section -->
            <div class="deg-analysis-section">
                <div class="analysis-card">
                    <h3>üß¨ Differentially Expressed Genes (DEGs)</h3>
                    <div class="deg-controls">
                        <div class="control-group">
                            <label for="deg-subtype">Cell Subtype:</label>
                            <select id="deg-subtype">
                                <option value="SLSFs_CD34pos">SLSFs CD34+</option>
                                <option value="SLSFs_CD34neg">SLSFs CD34-</option>
                                <option value="LLSFs">LLSFs</option>
                                <option value="SLSFs_IM">SLSFs IM</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="deg-comparison">Comparison:</label>
                            <select id="deg-comparison">
                                <option value="weight">Obesity vs Non-obese</option>
                                <option value="OA">OA vs Non-OA</option>
                                <option value="obeseOA">Obese-OA vs Healthy</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="deg-top-n">Top N genes:</label>
                            <select id="deg-top-n">
                                <option value="5">Top 5</option>
                                <option value="10">Top 10</option>
                                <option value="20">Top 20</option>
                                <option value="100">Top 100</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="deg-gene-filter">Filter by gene:</label>
                            <input type="text" id="deg-gene-filter" placeholder="Enter gene name (optional)" />
                        </div>
                        <button id="load-deg-btn" onclick="loadDEGData()">Load DEGs</button>
                    </div>
                    <div id="deg-table-container" class="deg-table-container">
                        <div class="viz-placeholder">
                            <p>üìä Select parameters and click "Load DEGs"</p>
                            <small>View top differentially expressed genes</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pathway Table Section -->
            <div class="pathway-table-section">
                <div class="analysis-card">
                    <h3>üõ§Ô∏è Pathway Enrichment Table</h3>
                    <div class="pathway-controls">
                        <div class="control-group">
                            <label for="pathway-subtype">Cell Subtype:</label>
                            <select id="pathway-subtype">
                                <option value="SLSFs_CD34pos">SLSFs CD34+</option>
                                <option value="SLSFs_CD34neg">SLSFs CD34-</option>
                                <option value="LLSFs">LLSFs</option>
                                <option value="SLSFs_IM">SLSFs IM</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="pathway-comparison">Comparison:</label>
                            <select id="pathway-comparison">
                                <option value="weight">Obesity vs Non-obese</option>
                                <option value="OA">OA vs Non-OA</option>
                                <option value="obeseOA">Obese-OA vs Healthy</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="pathway-top-n">Top N pathways:</label>
                            <select id="pathway-top-n">
                                <option value="5">Top 5</option>
                                <option value="10">Top 10</option>
                                <option value="20">Top 20</option>
                                <option value="50">Top 50</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="pathway-filter">Filter by pathway:</label>
                            <input type="text" id="pathway-filter" placeholder="Enter pathway name (optional)" />
                        </div>
                        <button id="load-pathway-btn" onclick="loadPathwayData()">Load Pathways</button>
                    </div>
                    <div id="pathway-table-container" class="deg-table-container">
                        <div class="viz-placeholder">
                            <p>üìä Pathway enrichment results will appear here</p>
                            <small>Load pathway data to view detailed results</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pathway Analysis Visualization -->
            <div class="analysis-card">
                <h3>üìà Pathway Analysis</h3>
                <div id="pathway-plot" class="viz-container">
                    <div class="viz-placeholder">
                        <div class="loading-spinner"></div>
                        <p>üîÑ Loading pathway analysis...</p>
                        <small>Select parameters and click "Load Pathways"</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Module 3: Cell Trajectory -->
        <div class="module-content" id="trajectory-module">
            <div class="analysis-card">
                <h3>üîÑ Cell Trajectory Analysis</h3>
                <div class="trajectory-container">
                    <img src="./assets/images/fig3.png" 
                         alt="Cell Trajectory Analysis" 
                         onload="console.log('‚úÖ Trajectory figure loaded')"
                         onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkNlbGwgVHJhamVjdG9yeSBGaWd1cmU8L3RleHQ+CiAgPHRleHQgeD0iNTAlIiB5PSI2MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPihJbWFnZSBub3QgZm91bmQ6IGZpZzMucG5nKTwvdGV4dD4KICA8L3N2Zz4K';">
                    <div class="analysis-description">
                        <h4>üìä Trajectory Analysis Results</h4>
                        <p>
                            <strong>Analysis:</strong> Pseudotime trajectory inference showing fibroblast differentiation pathways<br>
                            <strong>Method:</strong> Monocle3 trajectory reconstruction with UMAP embedding<br>
                            <strong>Key Findings:</strong> Distinct trajectories for CD34+ and CD34- fibroblast populations<br>
                            <strong>Temporal Resolution:</strong> Early, intermediate, and late differentiation states identified
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Module 4: Cell Interaction -->
        <div class="module-content" id="interaction-module">
            <div class="analysis-card">
                <h3>üîó Cell-Cell Interaction Analysis</h3>
                <div class="interaction-container">
                    <img src="./assets/images/fig4.png" 
                         alt="Cell-Cell Interaction Analysis" 
                         onload="console.log('‚úÖ Interaction figure loaded')"
                         onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkNlbGwtQ2VsbCBJbnRlcmFjdGlvbiBGaWd1cmU8L3RleHQ+CiAgPHRleHQgeD0iNTAlIiB5PSI2MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPihJbWFnZSBub3QgZm91bmQ6IGZpZzQucG5nKTwvdGV4dD4KICA8L3N2Zz4K';">
                    <div class="analysis-description">
                        <h4>üîó Interaction Analysis Results</h4>
                        <p>
                            <strong>Analysis:</strong> Ligand-receptor interaction networks between fibroblast subtypes<br>
                            <strong>Method:</strong> CellChat analysis with statistical significance testing<br>
                            <strong>Key Findings:</strong> Enhanced inflammatory signaling in obese OA conditions<br>
                            <strong>Interaction Types:</strong> Autocrine, paracrine, and ECM-receptor communications identified
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        Obese OA Data Portal | Contact: <a href="mailto:hangw@cardiff.ac.uk">hangw@cardiff.ac.uk</a>
    </footer>

    <!-- Load the JavaScript file -->
    <script src="app.js"></script>
</body>
</html>
